\setchapterimage{seaside}
\setchapterpreamble[u]{\margintoc}
\chapter{Hardware}
\labch{hardware}

%
% Key concepts and abilities
%==============================================================================
\begin{kaobox}[frametitle=In This Chapter]
you will learn
\begin{itemize}
	\item First topic
	\item Second topic
        \item Third topic
\end{itemize}

you will be able to
\begin{itemize}
        \item Task one
        \item Task two
        \item Task three
\end{itemize}
\end{kaobox}

% Introductory paragraph goes here
\blindtext

%
% Section: Stack Computers
%==============================================================================
\section{Stack Computers}
We will discuss stack computers\sidecite{Koopman1989}.


%
% Section: Architecture Block Diagram
%==============================================================================
\section{Architecture Block Diagram}

\begin{figure*}[h!]
\begin{lstlisting}
\                         +-----+     |||====\\    //=====\\
\                         | PC  |<===>|||    ||    ||     ||
\                         +-----+     | |  __\/_  _\/__   ||
\                                     |D|  \ A  \/  B /   ||
\                +-----+  +-----+     |A|   \  ALU   /    ||
\                | IO  |==| MAR |<====|T|    \______/     ||
\                +-----+  +-----+     |A|       ||        ||
\                            ||       | |     +------+    ||
\                         +-----+     |B|<====| TOS  |====//
\                         | PM  |<===>|U|     +------+
\                         +-----+     |S|<===>| DS1  |
\                                     | |     +------+
\                         +-----+     |||<===>| DS2  |
\                         | IR  |<===>|||     +------+
\                         +-----+     |||     +------+
\                         | CL  |     |||     | DS31 |
\                         +-----+     |||     +------+
\                                     |||
\                                     |||     +------+
\                                     |||<====| RS   |
\                                     |||     +------+
\                                     |||     +------+
\                                             | RS31 |
\                                             +------+
\end{lstlisting}
\caption[Architecture Block Diagram]{Simplified architecture block diagram}
\end{figure*}

\begin{figure*}[h!]
\begin{lstlisting}
                                               |||======================\\        //====\\
                                               |||                      ||        ||    ||
                                               ||| 000 ALU_NOP          ||        ||    ||
                                               ||| 001 ALU_ADD          ||        ||    ||
                                               ||| 010 ALU_SUB        __\/___  ___\/__  ||
                                               | | 011 ALU_AND        \  A   \/   B  /  ||
                                               | | 100 ALU_OR          \            /   ||
          +-------------------+       001 PC>  |1| 101 ALU_XOR          \   ALU    /    ||
          |   Program         |             |  |6| 110 ALU_<<   ALU_OP --\________/     ||
          |   Counter         |=============#=>| | 111 ALU_>>                ||         ||
          |                   |<===============|B|                           ||         ||
   ~MAS --| (PC++)            |-- 001 >PC      |I|  101 TOS>      +----------\/----+    ||
          |                   |                |T|  |             |   Top Of       |    ||
          +-------------------+                | |<=#=============|   Stack        |====//
              ||                               |D|                |                |
              ||                               |A|     101 >TOS --|   (cell 0)     |
          +---\/----+---------+       010 PM>  |T|  110 DS1>      +----------------+
          | Memory  | Program |             |  |A|  |             |   Data         |
          | Address |  Memory |=============#=>| |<=#=============|   Stack        |
          |         |         |<===============|B|===============>|   Cell 1       |
    MAS --|         |         |-- 010 >PM      |U|     110 >DS1 --|                |
    0 PC  +---/\----+---------+                |S|  111 DS2>      +----------------+
    1 MAR     ||                               | |  |             |   Data         |
              ||                               | |<=#=============|   Stack        |
          +-------------------+                |||===============>|   Cell 2       |
          |  Memory           |<===============|||     111 >DS2 --|                |
          |  Address Register |-- 011 >MAR     |||                +----------------+
          +-------------------+                |||                .                .
                                               |||                +----------------+
          +-------------------+                |||                |    DS31        |
          |   Instruction     |<===============|||                +----------------+
          |   Register        |                |||
          +-------------------+                |||  100 RS>       +----------------+
          | Instruction Cycle |                |||  |             |   Return       |
          |                   |                |||<=#=============|   Stack        |
          | 00 MAS=0          |                |||===============>|                |
          | 01 PM> ,>IR ,PC++ |                |||      100 >RS --|                |
          | 10                |                                   +----------------+
          | 11 CL = IR[]      |                                   .                .
          |                   |  Bits  Instruction Format         +----------------+
          +-------------------+  15-13 xxx------------- xyz>      |   RS31         |
          |   Control Logic   |  12-10 ---xxx---------- >xyz      +----------------+
          |                   |   9-7  ------xxx------- ALU_OP      
          +-------------------+    6   ---------x------ Memory Address Select (MAS)
                                   5   ----------x----- 
                                   4   -----------x---- 
                                   3   ------------x--- zero
                                   2   -------------x-- sign
                                   1   --------------x- carry
                                   0   ---------------x overflow
                                       000000xxxxxxxxxx NOP
                                 
                                                
\end{lstlisting}
\caption[Architecture Block Diagram]{Complete architecture block diagram}
\end{figure*}

\begin{figure*}[h!]
\begin{lstlisting}
\ <word>   <binary op code >     <stack >   <op code description>
: NOP      %0000000000000000  ;  (  --  )  ( No Operation )
: RESET    %1111111111111111  ;  (  --  )  ( Reser system )
\          %0000------------  ;  (  --  )  ( See NOP. Bits 15-12 - Source enable )
: DS1>     %0001000000000000  ;  (  --  )  ( Data Stack output )
: RS>      %0010000000000000  ;  (  --  )  ( Return Stack output )
: PC>      %0011000000000000  ;  (  --  )  ( Program Counter outout )
: PM>      %0100000000000000  ;  (  --  )  ( Program Memory output )
: IO>      %0101000000000000  ;  (  --  )  ( Input/Output output )
\          %0110------------  ;  (  --  )  (  )
: TOS>     %0111000000000000  ;  (  --  )  ( TOS output. Same as DS0> )
\          %1000------------  ;  (  --  )  (  )
\          %1001------------  ;  (  --  )  (  )
\ DS2>     %1010------------  ;  (  --  )  (  )
\          %1011------------  ;  (  --  )  (  )
\          %1100------------  ;  (  --  )  (  )
\          %1101------------  ;  (  --  )  (  )
\          %1110------------  ;  (  --  )  ( See RESET )
\          %1111------------  ;  (  --  )  ( reserved )
\          %----0000--------  ;  (  --  )  ( See NOP. Bits 11-08 - Destination enable )
: >DS      %0000000100000000  ;  (  --  )  ( into Data Stack )
: >RS      %0000001000000000  ;  (  --  )  ( into Return Stack )
: >PC      %0000001100000000  ;  (  --  )  ( into Program Counter )
: >PM      %0000010000000000  ;  (  --  )  ( into Program Memory )
: >IO      %0000010100000000  ;  (  --  )  ( into Input/Output )
\          %----0110--------  ;  (  --  )  (  )
: >TOS     %0000011100000000  ;  (  --  )  ( into TOS )
: >MAR     %0000100000000000  ;  (  --  )  ( into Memory Access Register )
: >IR      %0000100100000000  ;  (  --  )  ( into Instruction Register )
\ >DS2     %----1010--------  ;  (  --  )  (  )
\          %----1011--------  ;  (  --  )  (  )
\          %----1100--------  ;  (  --  )  (  )
\          %----1101--------  ;  (  --  )  (  )
\          %----1110--------  ;  (  --  )  (  )
\          %----1111--------  ;  (  --  )  ( See RESET )
\          %--------0000----  ;  (  --  )  ( See NOP. Bits 7-4 - ALU operation select )
: ALU_ADD  %0000000000010000  ;  (  --  )  ( ALU ADD enable )
: ALU_SUB  %0000000000100000  ;  (  --  )  ( ALU SUB enable ) \ necessary? 2s compliment
: ALU_AND  %0000000000110000  ;  (  --  )  ( ALU AND enable )
: ALU_OR   %0000000001000000  ;  (  --  )  ( ALU OR enable )
: ALU_XOR  %0000000001010000  ;  (  --  )  ( ALU XOR enable )
: ALU_<<   %0000000001100000  ;  (  --  )  (  )
: ALU_>>   %0000000001110000  ;  (  --  )  (  )
\          %0000000010000000  ;  (  --  )  (  )
\          %--------1001----  ;  (  --  )  (  )
\          %--------1010----  ;  (  --  )  (  )
\          %--------1011----  ;  (  --  )  (  )
\          %--------1101----  ;  (  --  )  (  )
\          %--------1110----  ;  (  --  )  ( See RESET )
\          %--------1111----  ;  (  --  )  ( reserved )
\          %------------0000  ;  (  --  )  ( See NOP. Bits 3-0 - Conditional branching/flags)
: if=0     %------------0001  ;  (  --  )  ( Zero )
: if<0     %------------0010  ;  (  --  )  ( Sign )
: if_C     %------------0100  ;  (  --  )  ( Carry )
: if_OF    %------------1000  ;  (  --  )  ( Overflow )
\          %------------1111  ;  (  --  )  ( See RESET )              
\end{lstlisting}
\caption[Instruction Set Architecture]{Instruction Set Architecture (ISA)}
\end{figure*}


